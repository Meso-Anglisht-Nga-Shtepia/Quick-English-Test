<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>English Level Mini Test (A1–C2)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #e0f2fe 0, #eef2ff 30%, #f9fafb 65%, #f3f4f6 100%);
      color: #111827;
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 24px 16px;
    }
    .container {
      max-width: 900px;
      width: 100%;
      background: #ffffffcc;
      backdrop-filter: blur(10px);
      padding: 26px 22px 30px;
      border-radius: 22px;
      box-shadow:
        0 24px 60px rgba(15, 23, 42, 0.18),
        0 0 0 1px rgba(148, 163, 184, 0.33);
    }
    header {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 18px;
      text-align: center;
    }
    header h1 {
      margin: 0;
      font-size: 1.9rem;
      letter-spacing: -0.03em;
    }
    header p {
      margin: 0;
      font-size: 0.95rem;
      color: #6b7280;
    }
    .pill-row {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }
    .pill {
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      background: #eef2ff;
      color: #4338ca;
      border: 1px solid #c7d2fe;
    }
    .pill.secondary {
      background: #ecfeff;
      color: #0f766e;
      border-color: #a5f3fc;
    }

    .section {
      margin-bottom: 26px;
      padding: 18px 16px 18px;
      border-radius: 16px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
    }
    .section-title {
      font-size: 1.05rem;
      font-weight: 700;
      margin: 0 0 4px;
    }
    .section-subtitle {
      margin: 0 0 10px;
      font-size: 0.9rem;
      color: #6b7280;
    }
    label {
      display: block;
      font-size: 0.9rem;
      margin-bottom: 4px;
      font-weight: 600;
      color: #374151;
    }
    input[type="text"],
    input[type="email"] {
      width: 100%;
      padding: 9px 11px;
      border-radius: 10px;
      border: 1px solid #cbd5f5;
      font-size: 0.94rem;
      background: #f9fafb;
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
    }
    input[type="text"]:focus,
    input[type="email"]:focus {
      outline: none;
      border-color: #4f46e5;
      box-shadow: 0 0 0 2px rgba(79,70,229,0.18);
      background: #ffffff;
    }
    .field-group {
      margin-bottom: 10px;
    }
    .hint {
      font-size: 0.8rem;
      color: #9ca3af;
      margin-top: 2px;
    }

    .btn-row {
      display: flex;
      justify-content: flex-end;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 14px;
    }
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 9px 18px;
      border-radius: 999px;
      border: none;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.05s ease, box-shadow 0.05s ease, background 0.15s ease, opacity 0.15s ease;
      user-select: none;
      gap: 7px;
      white-space: nowrap;
    }
    .btn-primary {
      background: linear-gradient(135deg, #4f46e5, #6366f1);
      color: #fff;
      box-shadow: 0 14px 28px rgba(79,70,229,0.35);
    }
    .btn-primary:hover {
      background: linear-gradient(135deg, #4338ca, #4f46e5);
      transform: translateY(-1px);
      box-shadow: 0 18px 34px rgba(79,70,229,0.4);
    }
    .btn-primary:active {
      transform: translateY(0);
      box-shadow: 0 8px 18px rgba(79,70,229,0.28);
    }
    .btn-secondary {
      background: #e5e7eb;
      color: #111827;
    }
    .btn-secondary:hover {
      background: #d1d5db;
    }
    .btn-ghost {
      background: transparent;
      color: #4b5563;
      border: 1px solid #e5e7eb;
    }
    .btn-ghost:hover {
      background: #f3f4f6;
    }

    .error {
      color: #b91c1c;
      font-size: 0.86rem;
      margin-top: 6px;
    }
    .hidden {
      display: none !important;
    }

    /* Quiz layout */
    #quiz-section {
      background: #fefefe;
    }
    .progress-wrapper {
      margin-bottom: 12px;
    }
    .progress-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.85rem;
      color: #6b7280;
      margin-bottom: 4px;
    }
    #progress-label {
      font-weight: 600;
      color: #4b5563;
    }
    .progress-bar-track {
      width: 100%;
      height: 9px;
      border-radius: 999px;
      background: #e5e7eb;
      overflow: hidden;
      position: relative;
    }
    .progress-bar-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #4f46e5, #22c55e, #facc15);
      background-size: 200% 100%;
      border-radius: 999px;
      transition: width 0.2s ease-out, transform 0.2s ease-out;
    }

    .question-shell {
      padding: 14px 13px;
      border-radius: 16px;
      background: #f9fafb;
      border: 1px solid #e5e7f6;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    #question-number {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: #6b7280;
      font-weight: 700;
    }
    #question-text {
      font-size: 1.02rem;
      font-weight: 600;
      color: #111827;
    }
    .options {
      margin-top: 6px;
      display: grid;
      gap: 6px;
    }
    .option-row {
      display: flex;
      align-items: flex-start;
      gap: 7px;
      padding: 7px 9px;
      border-radius: 10px;
      border: 1px solid transparent;
      background: #ffffff;
      cursor: pointer;
      transition: border-color 0.12s ease, background 0.12s ease, box-shadow 0.12s ease, transform 0.05s ease;
    }
    .option-row:hover {
      border-color: #c7d2fe;
      background: #eef2ff;
      box-shadow: 0 4px 12px rgba(148,163,184,0.3);
      transform: translateY(-0.5px);
    }
    .option-row input {
      margin-top: 2px;
      cursor: pointer;
    }
    .option-label-text {
      font-size: 0.95rem;
      color: #111827;
      cursor: pointer;
    }
    .option-row.selected {
      border-color: #4f46e5;
      background: #eef2ff;
      box-shadow: 0 6px 16px rgba(79,70,229,0.25);
    }

    .quiz-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 14px;
      gap: 10px;
      flex-wrap: wrap;
    }
    .step-hint {
      font-size: 0.8rem;
      color: #9ca3af;
    }

    /* Result section */
    #result-section {
      background: #fefce8;
      border-color: #facc15;
    }
    .result-box {
      border-radius: 16px;
      padding: 14px 14px 8px;
      background: #fffbeb;
      border: 1px solid #fed7aa;
      margin-top: 8px;
      margin-bottom: 14px;
    }
    .result-level {
      font-size: 1.5rem;
      font-weight: 800;
      letter-spacing: -0.03em;
    }
    .result-level span {
      font-size: 0.9rem;
      font-weight: 500;
      color: #4b5563;
    }
    #result-summary {
      margin: 6px 0 6px;
      font-size: 0.98rem;
      color: #374151;
    }
    #result-meta {
      font-size: 0.82rem;
      color: #6b7280;
    }

    .answers-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
      margin-top: 8px;
    }
    .answers-table th,
    .answers-table td {
      border: 1px solid #e5e7eb;
      padding: 5px 6px;
      vertical-align: top;
    }
    .answers-table th {
      background: #f3f4f6;
      text-align: left;
    }
    .correct {
      color: #15803d;
      font-weight: 600;
    }
    .incorrect {
      color: #b91c1c;
      font-weight: 600;
    }
    .muted {
      color: #6b7280;
      font-size: 0.85rem;
    }

    .footer-note {
      margin-top: 20px;
      text-align: center;
      font-size: 0.78rem;
      color: #9ca3af;
    }

    @media (max-width: 640px) {
      .container {
        padding: 20px 14px 24px;
      }
      header h1 {
        font-size: 1.5rem;
      }
      .section {
        padding: 14px 12px 16px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>10-Question English Level Check</h1>
      <p>Fast mini-test to estimate your CEFR level (A1–C2).</p>
      <div class="pill-row">
        <div class="pill">Takes ~3–5 minutes</div>
        <div class="pill secondary">See results instantly</div>
      </div>
    </header>

    <!-- LOGIN SECTION -->
    <section id="login-section" class="section">
      <h2 class="section-title">Step 1 · Tell us who you are</h2>
      <p class="section-subtitle">
        Enter your details so we can record your result and send you follow-up materials if needed.
      </p>

      <div class="field-group">
        <label for="username">Full name</label>
        <input type="text" id="username" placeholder="e.g. Maria Rossi" />
        <div class="hint">Use the name you’d like to appear in your report.</div>
      </div>

      <div class="field-group">
        <label for="email">Email address</label>
        <input type="email" id="email" placeholder="e.g. maria@example.com" />
        <div class="hint">We keep your email private. It’s only used to track your result.</div>
      </div>

      <div id="login-error" class="error hidden"></div>

      <div class="btn-row">
        <button id="start-btn" class="btn btn-primary">
          Start the test
          <span>→</span>
        </button>
      </div>
    </section>

    <!-- QUIZ SECTION -->
    <section id="quiz-section" class="section hidden">
      <h2 class="section-title">Step 2 · Answer the questions</h2>
      <p class="section-subtitle">
        Choose the best answer for each question. There is only one correct option.
      </p>

      <div class="progress-wrapper">
        <div class="progress-top">
          <span id="progress-label">Question 1 of 10</span>
          <span id="progress-percent">0%</span>
        </div>
        <div class="progress-bar-track">
          <div id="progress-bar" class="progress-bar-fill"></div>
        </div>
      </div>

      <div class="question-shell">
        <div id="question-number">Question 1</div>
        <div id="question-text">Loading question…</div>
        <div id="options-container" class="options"></div>
      </div>

      <div id="quiz-error" class="error hidden"></div>

      <div class="quiz-footer">
        <div class="step-hint">
          Tip: you can change your answers at any time before submitting.
        </div>
        <div class="btn-row">
          <button type="button" id="prev-btn" class="btn btn-ghost hidden">
            ← Previous
          </button>
          <button type="button" id="next-btn" class="btn btn-primary">
            Next question →
          </button>
        </div>
      </div>
    </section>

    <!-- RESULT SECTION -->
    <section id="result-section" class="section hidden">
      <h2 class="section-title">Step 3 · Your result</h2>
      <p class="section-subtitle">
        Here is your score, estimated CEFR level, and detailed answer breakdown.
      </p>

      <div class="result-box">
        <div class="result-level" id="result-level"></div>
        <p id="result-summary"></p>
        <p id="result-meta"></p>
      </div>

      <h3 style="margin: 6px 0 4px; font-size: 1rem;">Correct answers & feedback</h3>
      <p class="muted">
        Green = correct, Red = incorrect. This is a short screening test, not a full placement exam.
      </p>
      <div id="answer-breakdown"></div>

      <p class="muted" style="margin-top: 10px;">
        Your result has been recorded securely together with your name, email, and test date.
      </p>

      <div class="btn-row" style="justify-content: flex-end; margin-top: 12px;">
        <button type="button" id="restart-btn" class="btn btn-secondary">
          Take the test again
        </button>
      </div>
    </section>

    <div class="footer-note">
      © <span id="year"></span> English Level Mini Test · Data stored via Google Sheets
    </div>
  </div>

  <script>
    // === Your Google Apps Script Web App URL (already set to your link) ===
    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw6myuIEq7h43viSMdsXQ2kVaq8CSI--JqOSZ08DeqkS8CZPh0bdSuVpodkdU11W5UC/exec";

    // === 10-QUESTION TEST BANK ===
    const QUESTIONS = [
      {
        text: "Choose the correct option: “She ____ to the gym every morning.”",
        options: ["go", "is going", "goes", "going"],
        correctIndex: 2
      },
      {
        text: "Which sentence is correct?",
        options: [
          "I am agree with you.",
          "I agree with you.",
          "I am agreeing with you.",
          "I am agreed with you."
        ],
        correctIndex: 1
      },
      {
        text: "Complete the sentence: “If it ____ tomorrow, we will stay at home.”",
        options: ["will rain", "rains", "is raining", "rain"],
        correctIndex: 1
      },
      {
        text: "Which word best completes the sentence? “I’m really looking forward ____ you.”",
        options: ["to see", "to seeing", "seeing to", "see to"],
        correctIndex: 1
      },
      {
        text: "Choose the best option: “By this time tomorrow, I ____ my presentation.”",
        options: ["will finish", "will have finished", "am finishing", "have finished"],
        correctIndex: 1
      },
      {
        text: "Which sentence sounds the most natural?",
        options: [
          "Despite of the rain, we went out.",
          "In spite the rain, we went out.",
          "Although was raining, we went out.",
          "Despite the rain, we went out."
        ],
        correctIndex: 3
      },
      {
        text: "Choose the best option: “If I ____ more time, I would learn another language.”",
        options: ["have", "had", "would have", "will have"],
        correctIndex: 1
      },
      {
        text: "Choose the correct word: “This book is very ____ ; I can’t stop reading it.”",
        options: ["boring", "bored", "interesting", "interested"],
        correctIndex: 2
      },
      {
        text: "Select the most appropriate sentence:",
        options: [
          "Hardly I had arrived when it started to rain.",
          "Hardly had I arrived when it started to rain.",
          "Hardly had I arrived when did it start to rain.",
          "Hardly I had arrived when did it start to rain."
        ],
        correctIndex: 1
      },
      {
        text: "Choose the best option: “He denied ____ the document.”",
        options: ["to sign", "sign", "signing", "to signing"],
        correctIndex: 2
      }
    ];

    // Map raw score → CEFR band (simple mapping for 10 questions)
    function scoreToBand(score) {
      if (score <= 2) return "A1";
      if (score <= 4) return "A2";
      if (score <= 6) return "B1";
      if (score <= 8) return "B2";
      if (score === 9) return "C1";
      return "C2"; // 10/10
    }

    function bandDescription(band) {
      switch (band) {
        case "A1":
          return "You probably have a very basic level of English (beginner).";
        case "A2":
          return "You probably have an elementary level of English.";
        case "B1":
          return "You probably have a lower-intermediate / intermediate level.";
        case "B2":
          return "You probably have an upper-intermediate level.";
        case "C1":
          return "You probably have an advanced level of English.";
        case "C2":
          return "You probably have a very advanced / near-native level.";
        default:
          return "";
      }
    }

    // DOM elements
    const loginSection = document.getElementById("login-section");
    const quizSection = document.getElementById("quiz-section");
    const resultSection = document.getElementById("result-section");

    const loginError = document.getElementById("login-error");
    const quizError = document.getElementById("quiz-error");

    const startBtn = document.getElementById("start-btn");
    const prevBtn = document.getElementById("prev-btn");
    const nextBtn = document.getElementById("next-btn");
    const restartBtn = document.getElementById("restart-btn");

    const questionNumberEl = document.getElementById("question-number");
    const questionTextEl = document.getElementById("question-text");
    const optionsContainer = document.getElementById("options-container");

    const progressLabel = document.getElementById("progress-label");
    const progressPercent = document.getElementById("progress-percent");
    const progressBar = document.getElementById("progress-bar");

    const resultLevel = document.getElementById("result-level");
    const resultSummary = document.getElementById("result-summary");
    const resultMeta = document.getElementById("result-meta");
    const answerBreakdown = document.getElementById("answer-breakdown");

    document.getElementById("year").textContent = new Date().getFullYear();

    let currentIndex = 0;
    const userAnswers = new Array(QUESTIONS.length).fill(null);

    function scrollTopSmooth() {
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    function renderQuestion() {
      const q = QUESTIONS[currentIndex];

      questionNumberEl.textContent = `Question ${currentIndex + 1}`;
      questionTextEl.textContent = q.text;

      optionsContainer.innerHTML = "";
      q.options.forEach((opt, idx) => {
        const row = document.createElement("label");
        row.className = "option-row";
        row.dataset.index = idx;

        const input = document.createElement("input");
        input.type = "radio";
        input.name = "current-question";
        input.value = String(idx);

        const span = document.createElement("span");
        span.className = "option-label-text";
        span.textContent = opt;

        row.appendChild(input);
        row.appendChild(span);
        optionsContainer.appendChild(row);

        // Restore previously selected answer
        if (userAnswers[currentIndex] === idx) {
          input.checked = true;
          row.classList.add("selected");
        }

        // Click behaviour: select row
        row.addEventListener("click", () => {
          const rows = document.querySelectorAll(".option-row");
          rows.forEach(r => r.classList.remove("selected"));
          row.classList.add("selected");
          input.checked = true;
        });
      });

      // Progress info
      const total = QUESTIONS.length;
      const percent = Math.round((currentIndex / total) * 100);
      progressLabel.textContent = `Question ${currentIndex + 1} of ${total}`;
      progressPercent.textContent = `${percent}%`;
      progressBar.style.width = `${percent}%`;
      progressBar.style.transform = `translateX(${(percent / 100) * 5}px)`; // small animated feel

      // Buttons
      prevBtn.classList.toggle("hidden", currentIndex === 0);
      if (currentIndex === total - 1) {
        nextBtn.textContent = "Submit test →";
      } else {
        nextBtn.textContent = "Next question →";
      }

      quizError.classList.add("hidden");
      quizError.textContent = "";
    }

    function validateAndStoreAnswer() {
      const selectedInput = document.querySelector('input[name="current-question"]:checked');
      if (!selectedInput) {
        quizError.textContent = "Please select an answer before continuing.";
        quizError.classList.remove("hidden");
        return false;
      }
      const idx = Number(selectedInput.value);
      userAnswers[currentIndex] = idx;
      return true;
    }

    function showResult() {
      // Calculate score
      let correctCount = 0;
      QUESTIONS.forEach((q, i) => {
        if (userAnswers[i] === q.correctIndex) correctCount++;
      });

      const band = scoreToBand(correctCount);
      const percentage = Math.round((correctCount / QUESTIONS.length) * 100);
      const name = document.getElementById("username").value.trim();
      const email = document.getElementById("email").value.trim();
      const testDate = new Date();

      // Show result on page
      resultLevel.innerHTML = `Level: ${band} <span>(${correctCount} / ${QUESTIONS.length} · ${percentage}%)</span>`;
      resultSummary.textContent = bandDescription(band);
      resultMeta.textContent = `Name: ${name} · Email: ${email} · Test date: ${testDate.toLocaleString()}`;

      // Build answer breakdown table
      const table = document.createElement("table");
      table.className = "answers-table";

      const headerRow = document.createElement("tr");
      ["#", "Question", "Your answer", "Correct answer"].forEach((h) => {
        const th = document.createElement("th");
        th.textContent = h;
        headerRow.appendChild(th);
      });
      table.appendChild(headerRow);

      QUESTIONS.forEach((q, i) => {
        const tr = document.createElement("tr");

        const numCell = document.createElement("td");
        numCell.textContent = String(i + 1);
        tr.appendChild(numCell);

        const qCell = document.createElement("td");
        qCell.textContent = q.text;
        tr.appendChild(qCell);

        const yourCell = document.createElement("td");
        const correctCell = document.createElement("td");

        const userIndex = userAnswers[i];
        const correctIndex = q.correctIndex;

        if (userIndex === correctIndex) {
          yourCell.textContent = q.options[userIndex];
          yourCell.className = "correct";
        } else {
          yourCell.textContent = userIndex !== null ? q.options[userIndex] : "(no answer)";
          yourCell.className = "incorrect";
        }

        correctCell.textContent = q.options[correctIndex];
        correctCell.className = "correct";

        tr.appendChild(yourCell);
        tr.appendChild(correctCell);
        table.appendChild(tr);
      });

      answerBreakdown.innerHTML = "";
      answerBreakdown.appendChild(table);

      // Sections visibility
      quizSection.classList.add("hidden");
      resultSection.classList.remove("hidden");
      scrollTopSmooth();

      // Send data to Google Sheets via Apps Script
      if (GOOGLE_SCRIPT_URL) {
        const formData = new FormData();
        formData.append("name", name);
        formData.append("email", email);
        formData.append("score", String(correctCount));
        formData.append("total", String(QUESTIONS.length));
        formData.append("percentage", String(percentage));
        formData.append("band", band);
        formData.append("dateISO", testDate.toISOString());

        fetch(GOOGLE_SCRIPT_URL, {
          method: "POST",
          mode: "no-cors",
          body: formData
        }).catch((err) => {
          console.error("Failed to send data to Google Sheets:", err);
        });
      } else {
        console.warn("No Google Script URL configured – results not logged.");
      }
    }

    // Event handlers
    startBtn.addEventListener("click", () => {
      const name = document.getElementById("username").value.trim();
      const email = document.getElementById("email").value.trim();

      loginError.classList.add("hidden");
      loginError.textContent = "";

      if (!name || !email) {
        loginError.textContent = "Please enter both your name and email address.";
        loginError.classList.remove("hidden");
        return;
      }

      if (!email.includes("@") || !email.includes(".")) {
        loginError.textContent = "Please enter a valid email address.";
        loginError.classList.remove("hidden");
        return;
      }

      // Move to quiz
      loginSection.classList.add("hidden");
      quizSection.classList.remove("hidden");
      currentIndex = 0;
      renderQuestion();
      scrollTopSmooth();
    });

    nextBtn.addEventListener("click", () => {
      if (!validateAndStoreAnswer()) return;

      if (currentIndex === QUESTIONS.length - 1) {
        // Submit
        showResult();
      } else {
        currentIndex++;
        renderQuestion();
        scrollTopSmooth();
      }
    });

    prevBtn.addEventListener("click", () => {
      if (currentIndex > 0) {
        currentIndex--;
        renderQuestion();
        scrollTopSmooth();
      }
    });

    restartBtn.addEventListener("click", () => {
      window.location.reload();
    });
  </script>
</body>
</html>
